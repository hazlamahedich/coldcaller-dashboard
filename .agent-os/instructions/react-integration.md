---
description: Guide for integrating Agent OS with existing React/Node.js structure
globs:
alwaysApply: false
version: 1.0
encoding: UTF-8
---

# React/Node.js Integration Guide

<ai_meta>
  <rules>Maintain compatibility with existing Phase 0 React implementation</rules>
  <format>UTF-8, LF, 2-space indent</format>
</ai_meta>

## Integration with Existing React Architecture

### Current React Structure Analysis

```javascript
// Existing component architecture (Phase 0 Complete)
src/
├── App.js                 // Main dashboard layout
├── components/
│   ├── DialPad.js        // Phone keypad component
│   ├── AudioClipPlayer.js // Audio clip management
│   ├── ScriptDisplay.js   // Call scripts display
│   ├── LeadPanel.js      // Lead information panel
│   └── __tests__/        // Component test suites
├── data/
│   └── dummyData.js      // Test data (to be replaced in Phase 1)
└── utils/
    └── testUtils.js      // Testing utilities
```

### Agent OS Enhanced Development

#### Component Development with Agent OS
```bash
# Before creating any new component
@~/.agent-os/memory/context.md  # Load existing patterns

# Consult appropriate specialist
@~/.agent-os/agents/sales-specialist.md

# Request component creation following established patterns
"Create a new LeadScoringPanel component that:
- Uses the same inline styling approach as existing components
- Integrates with the current LeadPanel component
- Follows the existing testing patterns with 70%+ coverage
- Uses dummy data initially for Phase 0 compatibility"
```

#### Maintaining Architectural Consistency
```javascript
// Agent OS ensures all new components follow existing patterns:

// 1. Functional Components with Hooks
const NewComponent = () => {
  const [state, setState] = useState(initialValue);
  // Component logic here
};

// 2. Inline Styles Object
const styles = {
  container: {
    padding: '20px',
    backgroundColor: '#f9f9f9',
    borderRadius: '10px'
  },
  // More styles...
};

// 3. JSX Return with Style Application
return (
  <div style={styles.container}>
    {/* Component content */}
  </div>
);

// 4. Export Default
export default NewComponent;
```

### Backend Integration Planning (Phase 1)

#### API Integration with Agent OS Guidance
```bash
# Plan backend integration
@~/.agent-os/agents/lead-intelligence.md

# Request API architecture that maintains frontend compatibility
"Design Express.js API endpoints that can replace the dummy data imports in the React frontend without requiring component changes"
```

#### Seamless Data Transition Strategy
```javascript
// Current dummy data import (Phase 0)
import { dummyLeads } from '../data/dummyData';

// Future API integration (Phase 1) - same component interface
import { useLeadData } from '../hooks/useLeadData'; // Custom hook for API calls

// Component remains unchanged, only data source changes
const LeadPanel = () => {
  // Phase 0: const leads = dummyLeads;
  // Phase 1: const { leads, loading, error } = useLeadData();
  
  // Rest of component logic unchanged
};
```

### Agent OS Integration Patterns

#### Custom Hooks for API Integration
```bash
# Request custom hooks from Lead Intelligence Agent
@~/.agent-os/agents/lead-intelligence.md

"Create React custom hooks that:
- Replace dummy data imports with API calls
- Maintain the same data structure as existing dummy data
- Include loading and error states
- Are compatible with existing component logic"
```

```javascript
// Generated by Agent OS - Lead Intelligence Agent
// hooks/useLeadData.js
export const useLeadData = () => {
  const [leads, setLeads] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    // API integration logic
    fetchLeads()
      .then(data => {
        setLeads(data);
        setLoading(false);
      })
      .catch(err => {
        setError(err);
        setLoading(false);
      });
  }, []);

  return { leads, loading, error };
};
```

### VOIP Integration with React

#### Enhancing DialPad Component
```bash
# Consult VOIP Engineer for DialPad enhancement
@~/.agent-os/agents/voip-engineer.md

"Enhance the existing DialPad component to:
- Integrate with Twilio Voice SDK
- Maintain existing UI/UX exactly as implemented
- Replace console.log calls with real VOIP functionality
- Add call state management without changing component structure"
```

```javascript
// Agent OS enhanced DialPad with VOIP integration
import { Device } from '@twilio/voice-sdk';

const DialPad = () => {
  const [phoneNumber, setPhoneNumber] = useState('');
  const [isCalling, setIsCalling] = useState(false);
  const [device, setDevice] = useState(null); // New: Twilio device

  // Enhanced call handler with real VOIP
  const handleCall = async () => {
    if (phoneNumber.length > 0 && device) {
      setIsCalling(true);
      try {
        const call = await device.connect({
          params: { To: phoneNumber }
        });
        // Call state management
      } catch (error) {
        console.error('Call failed:', error);
        setIsCalling(false);
      }
    }
  };

  // Rest of component remains exactly the same
  // UI, styling, and user interactions unchanged
};
```

### Script Enhancement Integration

#### Dynamic Script Loading
```bash
# Consult Script Master for ScriptDisplay enhancement
@~/.agent-os/agents/script-master.md

"Enhance the ScriptDisplay component to:
- Support dynamic script personalization using lead data
- Maintain the existing color-coded tab interface
- Add real-time script suggestions
- Keep the same visual design and user experience"
```

```javascript
// Agent OS enhanced ScriptDisplay with personalization
const ScriptDisplay = ({ currentLead }) => {
  const [scripts, setScripts] = useState(dummyScripts);
  const [personalizedScript, setPersonalizedScript] = useState('');

  // New: Script personalization based on lead data
  useEffect(() => {
    if (currentLead) {
      const personalized = personalizeScript(scripts[selectedTab], currentLead);
      setPersonalizedScript(personalized);
    }
  }, [currentLead, selectedTab]);

  // Existing UI and functionality preserved
  return (
    <div style={styles.container}>
      {/* Same tab interface and styling */}
      <div style={styles.scriptText}>
        {personalizedScript || scripts[selectedTab]?.text}
      </div>
    </div>
  );
};
```

### Testing Integration with Agent OS

#### Enhanced Testing Patterns
```bash
# Maintain testing excellence with Agent OS guidance
@~/.agent-os/agents/sales-specialist.md

"Update the testing strategy to:
- Maintain 70%+ coverage requirement
- Test new API integration hooks
- Mock VOIP functionality for testing
- Follow existing Jest and React Testing Library patterns"
```

```javascript
// Agent OS enhanced testing approach
// __tests__/EnhancedComponent.test.js
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { jest } from '@jest/globals';
import EnhancedComponent from '../EnhancedComponent';

// Mock API calls and VOIP functionality
jest.mock('../hooks/useLeadData', () => ({
  useLeadData: () => ({
    leads: mockLeadData,
    loading: false,
    error: null
  })
}));

jest.mock('@twilio/voice-sdk', () => ({
  Device: jest.fn().mockImplementation(() => ({
    connect: jest.fn().mockResolvedValue({}),
    disconnect: jest.fn()
  }))
}));

// Tests follow existing patterns
describe('EnhancedComponent', () => {
  test('renders without crashing', () => {
    render(<EnhancedComponent />);
  });

  test('handles user interactions correctly', async () => {
    // Test implementation following existing patterns
  });
});
```

### Package.json Integration

#### Agent OS npm Scripts
```json
{
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build", 
    "test": "react-scripts test",
    "test:coverage": "react-scripts test --coverage --watchAll=false",
    
    "agent:context": "echo 'Loading Agent OS context...' && cat .agent-os/memory/context.md",
    "agent:sales": "echo 'Consulting Sales Specialist...'",
    "agent:scripts": "echo 'Consulting Script Master...'",
    "agent:leads": "echo 'Consulting Lead Intelligence...'",
    "agent:voip": "echo 'Consulting VOIP Engineer...'",
    "agent:quick-start": "cat .agent-os/instructions/quick-start.md"
  }
}
```

### Environment Configuration

#### Agent OS Environment Setup
```bash
# .env file for Agent OS integration
REACT_APP_AGENT_OS_ENABLED=true
REACT_APP_CURRENT_PHASE=1
REACT_APP_API_BASE_URL=http://localhost:3001/api

# VOIP Configuration (Phase 3)
REACT_APP_TWILIO_ACCOUNT_SID=your_twilio_account_sid
REACT_APP_TWILIO_AUTH_TOKEN=your_twilio_auth_token

# Agent OS Context
AGENT_OS_CONTEXT_PATH=./.agent-os/memory/context.md
```

### Development Workflow Integration

#### VS Code Integration
```json
// .vscode/settings.json
{
  "emmet.includeLanguages": {
    "javascript": "javascriptreact"
  },
  "files.associations": {
    "*.agent.md": "markdown"
  },
  "markdown.extension.toc.levels": "2..6",
  "agent-os.contextPath": "./.agent-os/memory/context.md",
  "agent-os.agentsPath": "./.agent-os/agents/"
}
```

#### Git Integration
```bash
# .gitignore additions for Agent OS
# Keep Agent OS configuration
!.agent-os/
.agent-os/temp/
.agent-os/cache/

# Environment files
.env.local
.env.development.local
.env.test.local
.env.production.local
```

### Performance Optimization

#### Agent OS Performance Guidelines
```bash
# Consult performance optimization
@~/.agent-os/agents/voip-engineer.md

"Optimize the React application for:
- Fast initial load times (<2s)
- Smooth VOIP call establishment (<3s)
- Responsive UI during API calls
- Efficient memory usage with WebRTC"
```

#### Bundle Size Management
```javascript
// Lazy loading for enhanced components
import { lazy, Suspense } from 'react';

const EnhancedLeadPanel = lazy(() => import('./components/EnhancedLeadPanel'));
const VOIPDialPad = lazy(() => import('./components/VOIPDialPad'));

const App = () => {
  return (
    <div className="App">
      <Suspense fallback={<div>Loading...</div>}>
        <EnhancedLeadPanel />
        <VOIPDialPad />
      </Suspense>
    </div>
  );
};
```

### Migration Strategy

#### Phase 0 to Phase 1 Transition
```bash
# 1. Maintain existing functionality
# All Phase 0 components continue working with dummy data

# 2. Add API integration layer
# Create custom hooks for API calls

# 3. Environment-based switching
# Use environment variables to switch between dummy and real data

# 4. Gradual component enhancement
# Enhance one component at a time with Agent OS guidance

# 5. Comprehensive testing
# Ensure all existing tests pass and new tests added
```

#### Backward Compatibility
```javascript
// Maintain compatibility during transition
const useDataSource = () => {
  const isDevelopment = process.env.NODE_ENV === 'development';
  const useAPIData = process.env.REACT_APP_USE_API === 'true';
  
  if (isDevelopment && !useAPIData) {
    // Phase 0: Use dummy data
    return { leads: dummyLeads, loading: false, error: null };
  } else {
    // Phase 1+: Use API data
    return useLeadData();
  }
};
```

This integration guide ensures that Agent OS enhances the existing React architecture without breaking any current functionality, while providing a clear path for future development phases.